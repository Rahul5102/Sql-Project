CREATE DATABASE SALES_INSIGHT;
USE SALES_INSIGHT;

CREATE TABLE CUSTOMERS (
    CUST_ID VARCHAR(15) PRIMARY KEY,
    CUST_NAME CHAR(50),
    CUST_TYPE CHAR(50)
);

INSERT INTO CUSTOMERS VALUES ('C001', 'LOGAN','REGULAR'),('C002','JONATHAN','PASS-BY'),('C003','JARVIS','REGULAR');

CREATE TABLE DATES (
CUSTOMER_CODE VARCHAR(15),
    FOREIGN KEY (CUSTOMER_CODE)
        REFERENCES CUSTOMERS (CUST_ID),
    CUST_DATE DATE NOT NULL,
    CUST_YEAR YEAR,
    MONTH_NAME CHAR(15)
);
DROP TABLE DATES;

INSERT INTO DATES VALUES ('C001','2022-05-01',2022,'MAY'),('C002','2022-06-25',2022,'JUNE');

CREATE TABLE MARKET (
    MARKET_CODE VARCHAR(15) PRIMARY KEY NOT NULL,
    MARKET_NAME CHAR(50),
    ZONE CHAR(50)
);

INSERT INTO MARKET VALUES('M123','MARKET1','NORTH'),('M124','MAKRKET2','SOUTHERN'),('M125','MARKET3','CENTRAL');

CREATE TABLE PRODUCTS (
    PRODUCT_ID VARCHAR(15) PRIMARY KEY NOT NULL,
    PRODUCT_TYPE VARCHAR(15)
);

INSERT INTO PRODUCTS VALUES( 'P999','DETERGENTS'),('P888','KITCHEN PRODUCT'),('P777','BATHING SOAP');

CREATE TABLE TRANSACTIONS (
    PRODUCT_ID VARCHAR(15),
    FOREIGN KEY (PRODUCT_ID)
        REFERENCES PRODUCTS (PRODUCT_ID),
    CUSTOMER_CODE VARCHAR(15),
    FOREIGN KEY (CUSTOMER_CODE)
        REFERENCES CUSTOMERS (CUST_ID),
    MARKET_CODE VARCHAR(15),
    FOREIGN KEY (MARKET_CODE)
        REFERENCES MARKET (MARKET_CODE),
    ORDER_DATE DATE,
    SALES_QUANTITY VARCHAR(15),
    SALES_AMOUNT FLOAT,
    CURRENCY CHAR(50),
    PROFIT_MARGIN FLOAT,
    PRICE FLOAT
);

INSERT INTO TRANSACTIONS VALUES('P999','C001','M123','2022-05-01','15KG',2500.05,'US DOLLAR','100.00',3000),
('P888','C002','M124','2022-06-25','10PKTS',1500.00,'US DOLLAR','89.00',1800),
('P777','C001','M125','2022-05-01','25PKTS',4000.50,'INR',98.75,5500);

SELECT 
    *
FROM
    CUSTOMERS
ORDER BY CUST_ID;

SELECT 
    COUNT(CUST_ID)
FROM
    CUSTOMERS;

SELECT 
    *
FROM
    TRANSACTIONS;

SELECT 
    PRODUCT_ID, CUSTOMER_CODE
FROM
    TRANSACTIONS
WHERE
    CURRENCY = 'US DOLLAR';


SELECT 
    D.CUSTOMER_CODE, T.PRODUCT_ID, T.PRICE
FROM
    DATES D
        JOIN
    TRANSACTIONS T ON D.CUSTOMER_CODE = T.CUSTOMER_CODE
WHERE
    CUST_YEAR = 2022;

SELECT 
    T.PRICE, C.CUSTOMER_CODE
FROM
    TRANSACTIONS T
        JOIN
    DATES C ON T.CUSTOMER_CODE = C.CUSTOMER_CODE
WHERE
    CUST_YEAR = 2022;


-- end --


CREATE TABLE TRANSACTIONS (
    PRODUCT_ID VARCHAR(15),
    FOREIGN KEY (PRODUCT_ID)
        REFERENCES PRODUCTS (PRODUCT_ID),
    CUSTOMER_CODE VARCHAR(15),
    FOREIGN KEY (CUSTOMER_CODE)
        REFERENCES CUSTOMERS (CUST_ID),
    MARKET_CODE VARCHAR(15),
    FOREIGN KEY (MARKET_CODE)
        REFERENCES MARKET (MARKET_CODE),
    ORDER_DATE DATE,
    SALES_QUANTITY VARCHAR(15),
    SALES_AMOUNT FLOAT,
    CURRENCY CHAR(50),
    PROFIT_MARGIN FLOAT,
    PRICE FLOAT
);

INSERT INTO TRANSACTIONS VALUES('P999','C001','M123','2022-05-01','15KG',2500.05,'US DOLLAR','100.00',3000),
('P888','C002','M124','2022-06-25','10PKTS',1500.00,'US DOLLAR','89.00',1800),
('P777','C001','M125','2022-05-01','25PKTS',4000.50,'INR',98.75,5500);





